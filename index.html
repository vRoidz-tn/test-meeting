<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Simple Flex Test</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; background:#f4f4f4; padding:20px; }
    #log { white-space: pre-wrap; background:#fff; padding:10px; border:1px solid #ccc; }
  </style>
</head>
<body>
<h3>Simple Flex Debug</h3>
<pre id="log">Loading…</pre>
<script>
const liffId = '2007795446-LJyk3OJ3';   // replace with your real LIFF ID

// simplest allowed Flex bubble
const simpleFlex = {
  type: 'flex',
  altText: 'ทดสอบ Flex',
  contents: {
    type: 'bubble',
    body: {
      type: 'box',
      layout: 'vertical',
      contents: [
        {
          type: 'text',
          text: 'Hello Flex',
          weight: 'bold',
          size: 'lg',
          align: 'center'
        },
        {
          type: 'button',
          action: { type: 'message', label: 'Click me', text: 'clicked' },
          style: 'primary',
          color: '#5B86E5'
        }
      ]
    }
  }
};

function log(msg){
  console.log(msg);
  document.getElementById('log').textContent += '\n' + msg;
}

async function main(){
  try{
    log('Initializing LIFF…');
    await liff.init({ liffId });
    log('LIFF init done');
    log('isInClient: ' + liff.isInClient());

    if (!liff.isInClient()){
      document.getElementById('log').textContent = 'กรุณาเปิดหน้านี้ใน LINE';
      return;
    }

    const profile = await liff.getProfile();
    log('Profile: ' + JSON.stringify(profile));

    log('Sending simple Flex…');
    await liff.sendMessages([simpleFlex]);
    log('Flex sent OK');

    liff.closeWindow();
  }catch(err){
    console.error('Error', err);
    document.getElementById('log').textContent += '\nส่งข้อความล้มเหลว\n' + err;
  }
}
main();
</script>
</body>
</html>
