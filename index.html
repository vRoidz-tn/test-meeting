<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Meeting Room Booking</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body{font-family:'Segoe UI',Tahoma,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);margin:0;padding:20px;min-height:100vh}
    .container{max-width:420px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.2);overflow:hidden}
    .header{background:linear-gradient(45deg,#5B86E5,#36D1DC);color:#fff;padding:25px;text-align:center}
    .form-container{padding:25px}
    .form-group{margin-bottom:18px}
    label{display:block;margin-bottom:6px;font-weight:600;color:#333}
    input{width:100%;padding:10px;border:2px solid #e1e5e9;border-radius:8px;font-size:15px;box-sizing:border-box}
    input:focus{outline:none;border-color:#5B86E5}
    .intention-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .intention-option{padding:16px;border:2px solid #e1e5e9;border-radius:12px;background:#f8f9fa;cursor:pointer;text-align:center}
    .intention-option.selected{border-color:#5B86E5;background:#5B86E5;color:#fff}
    .room-grid{display:grid;grid-template-columns:1fr;gap:8px}
    .room-option{padding:12px;border:2px solid #e1e5e9;border-radius:8px;background:#f8f9fa;text-align:center;cursor:pointer}
    .room-option.selected{background:#5B86E5;color:#fff;border-color:#5B86E5}
    .time-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .submit-btn{width:100%;padding:12px;background:linear-gradient(45deg,#5B86E5,#36D1DC);color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:600;margin-top:12px;cursor:pointer}
    .back-btn{width:100%;padding:10px;background:#6c757d;color:#fff;border:none;border-radius:8px;margin-top:8px;cursor:pointer}
    .cancel-btn{background:linear-gradient(45deg,#e74c3c,#c0392b)!important}
    .error{color:#e74c3c;font-size:13px;margin-top:4px}
    #log{background:#f8f9fa;border:1px solid #e1e5e9;border-radius:8px;padding:10px;margin-top:15px;font-size:12px;max-height:150px;overflow-y:auto;display:none}
  </style>
</head>
<body>
<div class="container">
  <div class="header"><h2>🏢 Meeting Room Booking</h2></div>
  <div class="form-container">

    <!-- Intent selection -->
    <div id="intentScreen">
      <label>🎯 เลือกการทำงาน</label>
      <div class="intention-grid">
        <div class="intention-option" data-intent="book">📝 จองห้อง</div>
        <div class="intention-option" data-intent="check">🔍 ตรวจสอบ</div>
        <div class="intention-option" data-intent="cancel">❌ ยกเลิก</div>
        <div class="intention-option" data-intent="edit">✏️ แก้ไข</div>
      </div>
    </div>

    <!-- Booking / Cancel form -->
    <form id="mainForm" style="display:none">
      <div class="form-group">
        <label>📋 หัวข้อประชุม</label>
        <input id="title">
      </div>
      <div class="form-group">
        <label>🏠 เลือกห้อง</label>
        <div class="room-grid" id="roomGrid">
          <div class="room-option" data-room="evolve">Evolve Room – 1F</div>
          <div class="room-option" data-room="strategic">Strategic Thinking – 2F</div>
          <div class="room-option" data-room="teamwork">Teamwork – 4F</div>
        </div>
      </div>
      <div class="form-group">
        <label>📅 วันที่</label>
        <input type="date" id="date">
      </div>
      <div class="form-group">
        <label>⏰ เวลา</label>
        <div class="time-row">
          <input type="time" id="start">
          <input type="time" id="end">
        </div>
      </div>
      <button type="submit" class="submit-btn" id="submitBtn">ส่ง</button>
      <button type="button" class="back-btn" id="backBtn">← กลับ</button>
    </form>

    <!-- Edit form -->
    <form id="editForm" style="display:none">
      <div class="form-group">
        <label>📋 หัวข้อประชุม</label>
        <input id="editTitle">
      </div>
      <label>🔖 เวลาเดิม</label>
      <div class="time-row">
        <input type="date" id="oldDate">
        <input type="time" id="oldStart">
        <input type="time" id="oldEnd">
      </div>
      <label>🏠 ห้องใหม่</label>
      <div class="room-grid" id="newRoomGrid">
        <div class="room-option" data-room="evolve">Evolve Room – 1F</div>
        <div class="room-option" data-room="strategic">Strategic Thinking – 2F</div>
        <div class="room-option" data-room="teamwork">Teamwork – 4F</div>
      </div>
      <label>📅 เวลาใหม่</label>
      <div class="time-row">
        <input type="date" id="newDate">
        <input type="time" id="newStart">
        <input type="time" id="newEnd">
      </div>
      <button type="button" class="submit-btn" id="saveEditBtn">บันทึก</button>
      <button type="button" class="back-btn" id="backFromEdit">← กลับ</button>
    </form>

    <div id="log"><b>Debug:</b><div id="logContent"></div></div>
  </div>
</div>

<script>
const liffId='2007795446-LJyk3OJ3';
let intent=null,room=null,newRoom=null,user=null;
const names={evolve:'Evolve Room',strategic:'Strategic Thinking Room',teamwork:'Teamwork Room'};

document.addEventListener('DOMContentLoaded',()=>{
  initLIFF();
  bindUI();
});

function initLIFF(){
  liff.init({liffId}).then(()=>{
    if(liff.isInClient()) liff.getProfile().then(p=>user=p);
    const t=new Date().toISOString().split('T')[0];
    document.getElementById('date').value=t;
    document.getElementById('oldDate').value=t;
    document.getElementById('newDate').value=t;
  }).catch(e=>console.log(e));
}

function bindUI(){
  document.querySelectorAll('.intention-option').forEach(el=>{
    el.onclick=()=>{
      intent=el.dataset.intent;
      document.querySelectorAll('.intention-option').forEach(i=>i.classList.remove('selected'));
      el.classList.add('selected');
      toggleForms();
    };
  });
  document.querySelectorAll('#roomGrid .room-option').forEach(o=>{
    o.onclick=()=>{document.querySelectorAll('#roomGrid .room-option').forEach(i=>i.classList.remove('selected'));o.classList.add('selected');room=o.dataset.room;};
  });
  document.querySelectorAll('#newRoomGrid .room-option').forEach(o=>{
    o.onclick=()=>{document.querySelectorAll('#newRoomGrid .room-option').forEach(i=>i.classList.remove('selected'));o.classList.add('selected');newRoom=o.dataset.room;};
  });
  document.getElementById('mainForm').onsubmit=e=>{e.preventDefault();sendMain();};
  document.getElementById('saveEditBtn').onclick=sendEdit;
  document.getElementById('backBtn').onclick=()=>toggleForms(true);
  document.getElementById('backFromEdit').onclick=()=>toggleForms(true);
}

function toggleForms(back){
  document.getElementById('intentScreen').style.display=back?'block':'none';
  document.getElementById('mainForm').style.display=(intent==='book'||intent==='cancel')&&!back?'block':'none';
  document.getElementById('editForm').style.display=intent==='edit'&&!back?'block':'none';
  if(intent==='check'&&!back) sendCheck();
}

function sendMain(){
  const title=document.getElementById('title').value.trim();
  const date=document.getElementById('date').value;
  const s=document.getElementById('start').value;
  const e=document.getElementById('end').value;
  let text='';
  if(intent==='book') text=`Booking Request\nเพื่อ '${title}' ที่ '${names[room]}' '${date}' '${s}'-'${e}'`;
  if(intent==='cancel') text=`Cancel Request\nเพื่อ '${title}' ที่ '${names[room]}' '${date}' '${s}'-'${e}'`;
  sendMsg(text);
}

function sendCheck(){sendMsg('Check Request');}

function sendEdit(){
  const t=document.getElementById('editTitle').value.trim();
  const od=document.getElementById('oldDate').value;
  const os=document.getElementById('oldStart').value;
  const oe=document.getElementById('oldEnd').value;
  const nd=document.getElementById('newDate').value;
  const ns=document.getElementById('newStart').value;
  const ne=document.getElementById('newEnd').value;
  const text=`Edit Request\nเพื่อ '${t}' ที่ '${names[room]||""}' '${od}' '${os}'-'${oe}' เป็น '${names[newRoom]||""}' '${nd}' '${ns}'-'${ne}'`;
  sendMsg(text);
}

function sendMsg(text){
  if(!liff.isInClient()){alert(text);return;}
  liff.sendMessages([{type:'text',text}]).then(()=>liff.closeWindow()).catch(e=>alert(e.message));
}
</script>
</body>
</html>
