<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Booking Flex Debug</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; background:#f4f4f4; padding:20px; }
    #log { white-space: pre-wrap; background:#fff; padding:10px; border:1px solid #ccc; }
  </style>
</head>
<body>
<h3>LIFF Debug</h3>
<pre id="log">Loadingâ€¦</pre>
<script>
const liffId = '2007795446-LJyk3OJ3';   // <<< put your LIFF ID here

const flexRoom = {
  type: 'flex',
  altText: 'à¹€à¸¥à¸·à¸­à¸à¸«à¹‰à¸­à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡',
  contents: {
    type: 'bubble',
    body: {
      type: 'box',
      layout: 'vertical',
      contents: [
        { type: 'text', text: 'à¹€à¸¥à¸·à¸­à¸à¸«à¹‰à¸­à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡', weight: 'bold', size: 'lg', align: 'center' },
        {
          type: 'box',
          layout: 'vertical',
          margin: 'lg',
          spacing: 'sm',
          contents: [
            { type: 'button', action: { type: 'postback', label: 'Evolve Room â€“ 1st floor', data: 'room=evolve' }, style: 'primary', color: '#5B86E5' },
            { type: 'button', action: { type: 'postback', label: 'Strategic Thinking Room â€“ 2nd floor', data: 'room=strategic' }, style: 'secondary' },
            { type: 'button', action: { type: 'postback', label: 'Teamwork Room â€“ 4th floor', data: 'room=teamwork' }, style: 'secondary' }
          ]
        }
      ]
    },
    styles: { body: { backgroundColor: '#FFFFFF' } }
  }
};

const flexDateTime = {
  type: 'flex',
  altText: 'à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¹à¸¥à¸°à¹€à¸§à¸¥à¸²',
  contents: {
    type: 'bubble',
    body: {
      type: 'box',
      layout: 'vertical',
      contents: [
        { type: 'text', text: 'à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¹à¸¥à¸°à¹€à¸§à¸¥à¸²', weight: 'bold', size: 'lg', align: 'center' },
        {
          type: 'box',
          layout: 'vertical',
          spacing: 'md',
          margin: 'lg',
          contents: [
            { type: 'button', action: { type: 'datetimepicker', label: 'ðŸ“… à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆ', data: 'selectDate', mode: 'date', initial: '2025-09-18', max: '2026-12-31', min: '2025-01-01' }, style: 'primary', color: '#5B86E5' },
            { type: 'button', action: { type: 'datetimepicker', label: 'â° à¹€à¸¥à¸·à¸­à¸à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡', data: 'selectStart', mode: 'time', initial: '09:00' }, style: 'secondary' },
            { type: 'button', action: { type: 'datetimepicker', label: 'â±ï¸ à¹€à¸¥à¸·à¸­à¸à¹€à¸§à¸¥à¸²à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”', data: 'selectEnd', mode: 'time', initial: '10:00' }, style: 'secondary' }
          ]
        }
      ]
    },
    styles: { body: { backgroundColor: '#FFFFFF' } }
  }
};

function log(msg){
  console.log(msg);
  document.getElementById('log').textContent += '\n' + msg;
}

async function main(){
  try{
    log('Initializing LIFFâ€¦');
    await liff.init({ liffId });
    log('LIFF init done');
    log('isInClient: ' + liff.isInClient());

    if (!liff.isInClient()){
      document.getElementById('log').textContent = 'à¸à¸£à¸¸à¸“à¸²à¹€à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¸™à¸µà¹‰à¹ƒà¸™ LINE';
      return;
    }

    const profile = await liff.getProfile();
    log('Profile: ' + JSON.stringify(profile));

    log('Step 1: send plain text');
    await liff.sendMessages([{ type:'text', text:'Test message from LIFF' }]);
    log('Text message sent OK');

    log('Step 2: send Flex messages');
    await liff.sendMessages([flexRoom, flexDateTime]);
    log('Flex messages sent OK');

    liff.closeWindow();
  }catch(err){
    console.error('Error sending', err);
    document.getElementById('log').textContent += '\nà¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§\n' + err;
  }
}
main();
</script>
</body>
</html>
