<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Booking Flex Debug (sequential)</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; background:#f4f4f4; padding:20px; }
    #log { white-space: pre-wrap; background:#fff; padding:10px; border:1px solid #ccc; }
  </style>
</head>
<body>
<h3>LIFF Debug</h3>
<pre id="log">Loading‚Ä¶</pre>
<script>
const liffId = '2007795446-LJyk3OJ3';   // put your LIFF ID here

const flexRoom = {
  type: 'flex',
  altText: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°',
  contents: {
    type: 'bubble',
    body: {
      type: 'box',
      layout: 'vertical',
      contents: [
        { type: 'text', text: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°', weight: 'bold', size: 'lg', align: 'center' },
        {
          type: 'box',
          layout: 'vertical',
          margin: 'lg',
          spacing: 'sm',
          contents: [
            { type: 'button', action: { type: 'message', label: 'Evolve Room ‚Äì 1st floor', text: 'room=evolve' }, style: 'primary', color: '#5B86E5' },
            { type: 'button', action: { type: 'message', label: 'Strategic Thinking Room ‚Äì 2nd floor', text: 'room=strategic' }, style: 'secondary' },
            { type: 'button', action: { type: 'message', label: 'Teamwork Room ‚Äì 4th floor', text: 'room=teamwork' }, style: 'secondary' }
          ]
        }
      ]
    },
    styles: { body: { backgroundColor: '#FFFFFF' } }
  }
};

const flexDateTime = {
  type: 'flex',
  altText: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤',
  contents: {
    type: 'bubble',
    body: {
      type: 'box',
      layout: 'vertical',
      contents: [
        { type: 'text', text: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤', weight: 'bold', size: 'lg', align: 'center' },
        {
          type: 'box',
          layout: 'vertical',
          spacing: 'md',
          margin: 'lg',
          contents: [
            { type: 'button', action: { type: 'datetimepicker', label: 'üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', data: 'selectDate', mode: 'date', initial: '2025-09-18', max: '2026-12-31', min: '2025-01-01' }, style: 'primary', color: '#5B86E5' },
            { type: 'button', action: { type: 'datetimepicker', label: '‚è∞ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°', data: 'selectStart', mode: 'time', initial: '09:00' }, style: 'secondary' },
            { type: 'button', action: { type: 'datetimepicker', label: '‚è±Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î', data: 'selectEnd', mode: 'time', initial: '10:00' }, style: 'secondary' }
          ]
        }
      ]
    },
    styles: { body: { backgroundColor: '#FFFFFF' } }
  }
};

function log(msg){
  console.log(msg);
  document.getElementById('log').textContent += '\n' + msg;
}

async function main(){
  try{
    log('Initializing LIFF‚Ä¶');
    await liff.init({ liffId });
    log('LIFF init done');
    log('isInClient: ' + liff.isInClient());

    if (!liff.isInClient()){
      document.getElementById('log').textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô LINE';
      return;
    }

    const profile = await liff.getProfile();
    log('Profile: ' + JSON.stringify(profile));

    // step 1: simple text
    log('Step 1: send plain text');
    await liff.sendMessages([{ type:'text', text:'Test message from LIFF' }]);
    log('Text sent OK');

    // step 2: first Flex
    log('Step 2: send room Flex');
    await liff.sendMessages([flexRoom]);
    log('Room Flex sent OK');

    // step 3: second Flex
    log('Step 3: send datetime Flex');
    await liff.sendMessages([flexDateTime]);
    log('DateTime Flex sent OK');

    liff.closeWindow();
  }catch(err){
    console.error('Error sending', err);
    document.getElementById('log').textContent += '\n‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß\n' + err;
  }
}

main();
</script>
</body>
</html>
